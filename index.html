<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Nursing Prometric Simulation</title>

<!-- Confetti Library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* ===== General ===== */
*{margin:0; padding:0; box-sizing:border-box; font-family: 'Roboto', sans-serif;}
html,body{height:100%; width:100%; overflow:hidden; background:#f0f4f8; color:#111; transition: opacity 0.5s;}
body.fade-out{opacity:0;}

/* ===== Landing Page ===== */
#landing{position:relative; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; height:100%; width:100%; padding:0; text-align:center; transition: opacity 1s ease;}
#landing.hidden{display:none;}

/* Upper image covers half viewport */
#landing img.upper-img{
  width:100%;
  max-height:50vh;
  object-fit:cover;
  display:block;
  z-index:0;
  position:relative;
}

#landing h1{font-size:1.5rem; color:#0077cc; margin:10px 0;}
#landing h3{font-size:0.9rem; color:#555; margin-bottom:20px;}

.social{display:flex; gap:15px; justify-content:center; flex-wrap:wrap; margin-bottom:20px;}
.social img{width:35px; height:35px; transition: transform 0.2s;}
.social img:hover{transform: scale(1.2);}

.registration{display:flex; flex-direction:column; gap:10px; width:100%; max-width:350px; margin-bottom:20px;}
.registration input{padding:10px; border-radius:5px; border:none; font-size:0.9rem;}
.registration button{padding:10px; border:none; border-radius:5px; background:#00aaff; color:#fff; cursor:pointer; font-size:1rem; transition: box-shadow 0.5s; animation: glow 2s infinite alternate;}
@keyframes glow{0%{box-shadow:0 0 5px rgba(0,170,255,0.5);}50%{box-shadow:0 0 15px rgba(0,170,255,0.8);}100%{box-shadow:0 0 5px rgba(0,170,255,0.5);}}

/* Unlock message */
#unlockMessage{margin-top:10px; font-size:1.2rem; font-weight:bold; opacity:0; color:#00c853; transition:0.8s;}
#unlockMessage.show{opacity:1;}

#startQuizBtn{
  padding:10px 20px;
  display:none;
  margin-top:10px;
  background:#00aaff;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
  z-index:1;
}

#qrImage{
  position:absolute;
  bottom:15px;
  right:15px;
  max-width:100px;
  opacity:0.85;
}

/* Canvas water background */
#waterCanvas{
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
  height:50%;
  z-index:0;
}

/* Overlay */
.landing-content-overlay {
  position: relative;
  z-index: 1;
  padding: 20px;
  background: linear-gradient(to top, rgba(240,244,248,0.9), rgba(240,244,248,0.5));
  border-radius: 12px;
  margin-top:-30px;
}

/* Popup */
.popup{
  position: fixed;
  top:15px;
  left:50%;
  transform: translateX(-50%) translateY(-50px);
  background:#00aaff;
  color:#fff;
  padding:12px 20px;
  border-radius:8px;
  opacity:0;
  pointer-events:none;
  z-index:9999;
  transition: opacity 0.5s, transform 0.5s;
}
.popup.show{
  opacity:1;
  transform: translateX(-50%) translateY(0);
}

/* ===== Quiz Page ===== */
#quizPage{display:none; height:100%; width:100%; overflow-y:auto; padding:15px;}

.quiz-header{text-align:center; margin-bottom:20px;}
.question-card{background:#fff; padding:15px 20px; border-radius:12px; margin-bottom:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.options{display:flex; flex-direction:column; margin-top:10px;}
.option{background:#e4e8ec; margin:6px 0; padding:12px 15px; border-radius:8px; cursor:pointer;}
.option:hover{background:#c9d4e3;}
.option.correct{background:#00c853; color:#fff;}
.option.incorrect{background:#d50000; color:#fff;}

.quiz-footer{position:sticky; bottom:0; background:#fff; padding:10px 15px; display:flex; justify-content:space-between; border-top:1px solid #ddd;}
.quiz-footer button{padding:10px 15px; border:none; border-radius:8px; cursor:pointer; background:#0077cc; color:#fff; flex:1; margin:0 5px;}
</style>

</head>
<body>

<!-- ===== Landing Page ===== -->
<div id="landing">
  <img class="upper-img" src="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest5/main/assets/icon.jpg" alt="icon">
  <canvas id="waterCanvas"></canvas>

  <div class="landing-content-overlay">
    <h1>Nursing Prometric Actual Simulation Test</h1>
    <h3>Based on Prometric/SMLE Saudi Council & ENCLEX test materials<br>Prepared by Giyono Asfarrasyid, ETK Yogyakarta</h3>

    <div class="social">
      <a href="tel:+6285399652487"><img src="https://cdn-icons-png.flaticon.com/512/597/597177.png"></a>
      <a href="https://wa.me/6285399652487"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png"></a>
      <a href="mailto:gyoutrain@gmail.com"><img src="https://cdn-icons-png.flaticon.com/512/732/732200.png"></a>
      <a href="https://web.facebook.com/gyouskill/"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png"></a>
      <a href="https://www.instagram.com/etkyogya"><img src="https://cdn-icons-png.flaticon.com/512/733/733558.png"></a>
    </div>

    <div class="registration">
      <input type="text" id="username" placeholder="User Name">
      <input type="text" id="wanumber" placeholder="WA Number">
      <button id="registerBtn">Register</button>
    </div>

    <div id="unlockMessage"></div>
    <button id="startQuizBtn">Load & Start Quiz</button>

    <img id="qrImage" src="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest5/main/assets/danaqr.png" alt="danaqr">
  </div>
</div>

<!-- ===== Quiz Page ===== -->
<div id="quizPage">
  <div class="quiz-header">
    <h1>Prometric Nursing Quiz</h1>
    <h3 id="questionCounter">Question 1 of 20</h3>
  </div>
  <div id="quizContent"></div>
  <div class="quiz-footer">
    <button id="prevBtn">Previous</button>
    <button id="nextBtn">Next</button>
  </div>
</div>

<div class="popup" id="popup"></div>

<script>
/* ===== Popup ===== */
function showPopup(msg){
  const p = document.getElementById("popup");
  p.textContent = msg;
  p.classList.add("show");
  setTimeout(()=> p.classList.remove("show"), 2500);
}

/* ===== Confetti ===== */
function triggerConfetti(){
  confetti({
    particleCount:80,
    spread:70,
    origin:{ y:0.6 }
  });
}

/* ===== Water background ===== */
const canvas = document.getElementById("waterCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight/2;

const bg = new Image();
bg.src = "https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest5/main/assets/icon.jpg";

let offset = 0;
bg.onload = function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  offset += 0.5;
  ctx.globalAlpha = 0.15;

  ctx.drawImage(bg, -offset, 0, canvas.width, canvas.height);
  ctx.drawImage(bg, canvas.width - offset, 0, canvas.width, canvas.height);

  ctx.globalAlpha = 1;
  requestAnimationFrame(animate);
};

/* ===== Registration ===== */
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx8D_T9emzTO-rm6fJ-qIPMNVLjWhryz0xs6lLqUTGzAePQ0Tdsq14RFiEKs2drsFOb-w/exec";

document.getElementById("registerBtn").addEventListener("click",async()=>{
  const name = document.getElementById("username").value.trim();
  const phone= document.getElementById("wanumber").value.trim();

  if(!name || !phone){
    showPopup("Fill all fields!");
    return;
  }

  try{
    const res = await fetch(GOOGLE_SCRIPT_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name, phone})
    });

    const data = await res.json();
    if(data.ok){
      document.getElementById("unlockMessage").textContent = data.unlockCode;
      document.getElementById("unlockMessage").classList.add("show");
      document.getElementById("startQuizBtn").style.display = "inline-block";
      triggerConfetti();
      showPopup("Unlock code sent!");
    } else {
      showPopup(data.message);
    }
  } catch(e){
    console.error(e);
    showPopup("Server error!");
  }
});

/* ===== Quiz Loader ===== */
let questions = [];
let currentIndex = 0;

document.getElementById("startQuizBtn").addEventListener("click",()=>{
  document.getElementById("landing").style.display="none";
  document.getElementById("quizPage").style.display="block";

  const code = document.getElementById("unlockMessage").textContent;
  const user = document.getElementById("username").value.trim();
  const wa   = document.getElementById("wanumber").value.trim();

  loadQuestions(code, user, wa);
});

async function loadQuestions(code, user, wa){
  try{
    const url = `${GOOGLE_SCRIPT_URL}?unlock=${encodeURIComponent(code)}&username=${encodeURIComponent(user)}&wa=${encodeURIComponent(wa)}`;
    const res = await fetch(url);
    questions = await res.json();
    renderQuestion();
  } catch(e){
    console.error(e);
    document.getElementById("quizContent").innerHTML="<p style='color:red;'>Failed to load questions.</p>";
  }
}

function renderQuestion(){
  if(!questions.length) return;

  const q = questions[currentIndex];
  const box = document.getElementById("quizContent");

  box.innerHTML = `
    <div class="question-card">
      <p>${q.question}</p>
      <div class="options"></div>
    </div>
  `;

  const optBox = box.querySelector(".options");
  q.options.forEach((opt,i)=>{
    const div=document.createElement("div");
    div.className="option";
    div.textContent=opt;

    div.onclick=()=> selectAnswer(div,i,q.correctIndex);
    optBox.appendChild(div);
  });

  document.getElementById("questionCounter").textContent =
    `Question ${currentIndex+1} of ${questions.length}`;
}

function selectAnswer(el,idx,correct){
  const all = el.parentElement.children;
  for(const x of all) x.classList.remove("correct","incorrect");

  if(idx===correct) el.classList.add("correct");
  else el.classList.add("incorrect");
}

document.getElementById("prevBtn").onclick = ()=>{
  if(currentIndex>0){
    currentIndex--;
    renderQuestion();
  }
};

document.getElementById("nextBtn").onclick = ()=>{
  if(currentIndex < questions.length-1){
    currentIndex++;
    renderQuestion();
  }
};
</script>
</body>
</html>
