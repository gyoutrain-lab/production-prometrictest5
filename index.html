<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Nursing Prometric Simulation</title>

<!-- Confetti Library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* ===== General ===== */
*{margin:0; padding:0; box-sizing:border-box; font-family: 'Roboto', sans-serif;}
html,body{height:100%; width:100%; overflow:hidden; background:#f0f4f8; color:#111; transition: opacity 0.5s;}
body.fade-out{opacity:0;}

/* ===== Landing Page ===== */
#landing{position:relative; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; height:100%; width:100%; padding:0; text-align:center; transition: opacity 1s ease;}
#landing.hidden{display:none;}

/* Upper image covers half viewport */
#landing img.upper-img{
  width:100%;
  max-height:50vh; /* half of viewport height */
  object-fit:cover;
  display:block;
  z-index:0;
  position:relative;
}

#landing h1{font-size:1.5rem; color:#0077cc; margin:10px 0; z-index:1; position:relative;}
#landing h3{font-size:0.9rem; color:#555; margin-bottom:20px; z-index:1; position:relative;}

.social{display:flex; gap:15px; justify-content:center; flex-wrap:wrap; margin-bottom:20px; position:relative; z-index:1;}
.social img{width:35px; height:35px; transition: transform 0.2s;}
.social img:hover{transform: scale(1.2);}
.registration{display:flex; flex-direction:column; gap:10px; width:100%; max-width:350px; margin-bottom:20px; position:relative; z-index:1;}
.registration input{padding:10px; border-radius:5px; border:none; font-size:0.9rem;}
.registration button{padding:10px; border:none; border-radius:5px; background:#00aaff; color:#fff; cursor:pointer; font-size:1rem; transition: box-shadow 0.5s; animation: glow 2s infinite alternate;}
@keyframes glow{0%{box-shadow:0 0 5px rgba(0,170,255,0.5);}50%{box-shadow:0 0 15px rgba(0,170,255,0.8);}100%{box-shadow:0 0 5px rgba(0,170,255,0.5);}}

#unlockMessage{margin-top:15px; font-weight:bold; color:#00ff0a; font-size:1.2rem; opacity:0; transition: all 0.8s; position:relative; z-index:1;}
#unlockMessage.show{opacity:1; animation: pulse 1s ease-in-out, floatBG 3s infinite alternate;}
@keyframes pulse{0%{transform:scale(0.95);}50%{transform:scale(1.05);}100%{transform:scale(1);}}
@keyframes floatBG{0%{text-shadow:0 0 2px #00ff0a,0 0 6px #00ff0a;}50%{text-shadow:0 0 4px #00ff0a,0 0 12px #00ff0a;}100%{text-shadow:0 0 2px #00ff0a,0 0 6px #00ff0a;}}

#startQuizBtn{padding:10px 20px; display:none; margin-top:10px; background:#00aaff; color:#fff; border:none; border-radius:5px; cursor:pointer; position:relative; z-index:1;}
#qrImage{position:absolute; bottom:15px; right:15px; max-width:100px; transition: transform 1s, opacity 1s; z-index:1;}

/* Canvas for flowing water background */
#waterCanvas{position:absolute; bottom:0; left:0; width:100%; height:50%; z-index:0;}

/* Gradient overlay behind text for readability */
.landing-content-overlay {
  position: relative;
  z-index: 1;
  text-align: center;
  padding: 20px;
  background: linear-gradient(to top, rgba(240,244,248,0.8) 0%, rgba(240,244,248,0.3) 100%);
  border-radius: 12px;
  margin-top:-30px; /* lifts overlay over image */
}

/* Popup */
.popup{position: fixed; top:15px; left:50%; transform: translateX(-50%) translateY(-50px); background: rgba(0,170,255,0.95); color:#fff; padding:12px 20px; border-radius:8px; font-size:0.95rem; font-weight:500; box-shadow:0 4px 12px rgba(0,0,0,0.3); opacity:0; pointer-events:none; z-index:9999; transition: opacity 0.5s, transform 0.5s;}
.popup.show{opacity:1; transform: translateX(-50%) translateY(0);}

/* ===== Quiz Page ===== */
#quizPage{display:none; height:100%; width:100%; overflow-y:auto; -webkit-overflow-scrolling: touch; padding:15px;}
.quiz-header{text-align:center; margin-bottom:20px;}
.quiz-header h1{font-size:1.5rem; color:#0077cc; margin-bottom:5px;}
.quiz-header h3{font-size:0.9rem; color:#555;}
.question-card{background:#fff; padding:15px 20px; border-radius:12px; margin-bottom:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.question-card p{font-size:1rem; line-height:1.4; color:#222;}
.options{display:flex; flex-direction:column; margin-top:10px;}
.option{background:#e4e8ec; margin:6px 0; padding:12px 15px; border-radius:8px; font-size:0.95rem; cursor:pointer; transition: all 0.3s ease;}
.option:hover{background:#c9d4e3;}
.option.correct{background:#00c853; color:#fff;}
.option.incorrect{background:#d50000; color:#fff;}
.quiz-footer{position:sticky; bottom:0; background:#fff; padding:10px 15px; display:flex; justify-content:space-between; border-top:1px solid #ddd; box-shadow:0 -2px 5px rgba(0,0,0,0.05); z-index:10;}
.quiz-footer button{padding:10px 15px; font-size:1rem; border:none; border-radius:8px; cursor:pointer; background:#0077cc; color:#fff; flex:1; margin:0 5px; transition: background 0.3s, transform 0.2s;}
.quiz-footer button:hover{background:#005fa3; transform:translateY(-2px);}
@media(max-width:480px){.quiz-header h1{font-size:1.2rem;}.quiz-header h3{font-size:0.8rem;}.option{font-size:0.9rem;padding:10px 12px;}.quiz-footer button{font-size:0.9rem;padding:8px 10px;margin:0 3px;}}
</style>
</head>
<body>

<!-- ===== Landing Page ===== -->
<div id="landing">
  <!-- Upper half image -->
  <img class="upper-img" src="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest5/main/assets/icon.jpg" alt="icon">

  <!-- Canvas for flowing lower-half background -->
  <canvas id="waterCanvas"></canvas>

  <!-- Landing content with gradient overlay -->
  <div class="landing-content-overlay">
    <h1>Nursing Prometric Actual Simulation Test</h1>
    <h3>Based on Prometric/SMLE Saudi Council & ENCLEX test materials (tricky/hard)<br>Prepared by Giyono Asfarrasyid, ETK Yogyakarta</h3>

    <div class="social">
      <a href="tel:+6285399652487"><img src="https://cdn-icons-png.flaticon.com/512/597/597177.png"></a>
      <a href="https://wa.me/6285399652487"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png"></a>
      <a href="mailto:gyoutrain@gmail.com"><img src="https://cdn-icons-png.flaticon.com/512/732/732200.png"></a>
      <a href="https://web.facebook.com/gyouskill/"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png"></a>
      <a href="https://www.instagram.com/etkyogya"><img src="https://cdn-icons-png.flaticon.com/512/733/733558.png"></a>
    </div>

    <div class="registration">
      <input type="text" id="username" placeholder="User Name">
      <input type="text" id="wanumber" placeholder="WA Number">
      <button id="registerBtn">Register</button>
    </div>

    <div id="unlockMessage"></div>
    <button id="startQuizBtn">Load & Start Quiz</button>
    <img id="qrImage" src="https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest5/main/assets/danaqr.png" alt="danaqr">
  </div>
</div>

<!-- ===== Quiz Page ===== -->
<div id="quizPage">
  <div class="quiz-header">
    <h1>Prometric Nursing Quiz</h1>
    <h3 id="questionCounter">Question 1 of 20</h3>
  </div>
  <div id="quizContent"></div>
  <div class="quiz-footer">
    <button id="prevBtn">Previous</button>
    <button id="nextBtn">Next</button>
  </div>
</div>

<div class="popup" id="popup"></div>

<script>
/* ===== Popup ===== */
const popup = document.getElementById('popup');
function showPopup(msg){popup.textContent=msg; popup.classList.add('show'); setTimeout(()=>popup.classList.remove('show'),3000);}

/* ===== Confetti Unlock Animation ===== */
function triggerConfetti(){
  const duration = 3*1000;
  const animationEnd = Date.now() + duration;
  const defaults = { startVelocity:30, spread:360, ticks:60, zIndex:1000 };
  const interval = setInterval(function(){
    const timeLeft = animationEnd - Date.now();
    if(timeLeft <=0) return clearInterval(interval);
    const particleCount = 50*(timeLeft/duration);
    confetti(Object.assign({}, defaults, { particleCount, origin:{x:Math.random(),y:Math.random()-0.2} }));
  },250);
}

/* ===== Flowing Water Background ===== */
const canvas = document.getElementById("waterCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight / 2;
const bgImage = new Image();
bgImage.src = "https://raw.githubusercontent.com/gyoutrain-lab/production-prometrictest5/main/assets/icon.jpg";
let offset = 0;
function drawWaterImage(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  offset += 0.5;
  ctx.globalAlpha = 0.15;
  ctx.drawImage(bgImage, -offset, 0, canvas.width, canvas.height);
  ctx.drawImage(bgImage, canvas.width - offset, 0, canvas.width, canvas.height);
  ctx.globalAlpha = 1;
  requestAnimationFrame(drawWaterImage);
}
bgImage.onload = drawWaterImage;
window.addEventListener("resize", ()=>{canvas.width = window.innerWidth; canvas.height = window.innerHeight / 2;});

/* ===== Landing Page Logic ===== */
const registerBtn = document.getElementById('registerBtn');
const unlockMessage = document.getElementById('unlockMessage');
const startQuizBtn = document.getElementById('startQuizBtn');
const landing = document.getElementById('landing');
const quizPage = document.getElementById('quizPage');

const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyH0CRYjz2TXGEX8W2n56rnW63_X80lmd88dKeRmNrJugJM-mcx6fwVXmub2MTt8jAmeA/exec";

registerBtn.addEventListener('click', async()=>{
  const name = document.getElementById('username').value.trim();
  const phone = document.getElementById('wanumber').value.trim();
  if(!name||!phone){showPopup("Fill all fields!"); return;}

  try{
    const res = await fetch(GOOGLE_SCRIPT_URL,{
      method:"POST",
      body: JSON.stringify({name, phone})
    });
    const data = await res.json();
    if(data.ok){
      unlockMessage.textContent = data.unlockCode;
      unlockMessage.classList.add("show");
      showPopup("Unlock code sent to admin!");
      startQuizBtn.style.display = "inline-block";
      triggerConfetti();
    } else { showPopup(data.message); }
  } catch(e){showPopup("Server error!"); console.error(e);}
});

/* ===== Start Quiz ===== */
startQuizBtn.addEventListener('click',()=>{
  landing.classList.add("hidden");
  quizPage.style.display="block";
  const unlockCode = unlockMessage.textContent;
  const username = document.getElementById('username').value.trim();
  const wa = document.getElementById('wanumber').value.trim();
  loadQuestions(unlockCode, username, wa);
});

/* ===== Quiz Loader ===== */
let questions=[], currentIndex=0;
async function loadQuestions(unlockCode, username, wa){
  try{
    const response = await fetch(`${GOOGLE_SCRIPT_URL}?unlock=${encodeURIComponent(unlockCode)}&username=${encodeURIComponent(username)}&wa=${encodeURIComponent(wa)}`);
    questions = await response.json();
    renderQuestion();
  } catch(e){console.error(e); document.getElementById("quizContent").innerHTML="<p style='color:red;'>Failed to load quiz.</p>";}
}

function renderQuestion(){
  if(questions.length===0) return;
  const q=questions[currentIndex];
  const container=document.getElementById("quizContent");
  container.innerHTML="";
  const card=document.createElement("div");
  card.className="question-card";
  card.innerHTML=`<p>${q.question}</p>`;
  const opts=document.createElement("div");
  opts.className="options";
  q.options.forEach((opt, idx)=>{
    const div=document.createElement("div");
    div.className="option"; div.textContent=opt;
    div.addEventListener("click",()=>selectAnswer(div, idx, q.correctIndex));
    opts.appendChild(div);
  });
  card.appendChild(opts);
  container.appendChild(card);
  document.getElementById("questionCounter").textContent=`Question ${currentIndex+1} of ${questions.length}`;
}

function selectAnswer(element, idx, correctIdx){
  const siblings=element.parentElement.children;
  for(let sib of siblings) sib.classList.remove("correct","incorrect");
  if(idx===correctIdx) element.classList.add("correct"); else element.classList.add("incorrect");
}

/* ===== Navigation ===== */
document.getElementById("prevBtn").addEventListener("click",()=>{if(currentIndex>0){currentIndex--; renderQuestion();}});
document.getElementById("nextBtn").addEventListener("click",()=>{if(currentIndex<questions.length-1){currentIndex++; renderQuestion();}});
</script>
</body>
</html>
